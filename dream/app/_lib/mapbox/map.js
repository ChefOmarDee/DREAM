"use client";

import React, { useRef, useState } from 'react';
import Map, { Source, Layer } from 'react-map-gl';

const MAPBOX_TOKEN = "pk.eyJ1IjoiYnJvcDEiLCJhIjoiY20xd2YxOWcxMG04NjJsb3JwdjV6a3E0OCJ9.D_iqH_nw8cEFZMicjWPVog"; // Use your Mapbox token here

const MapComponent = () => {
  const mapRef = useRef();
  const [zipCode, setZipCode] = useState('');

  // Coordinates for a larger square around Washington, DC
  const squareCoordinates = [
    [ -80.41457250104, 27.55794136438 ], [ -80.41457550099, 27.55789836432 ], [ -80.41457050091, 27.55783236425 ], [ -80.4145695009, 27.55782036423 ], [ -80.41456750088, 27.55780136421 ], [ -80.41456550085, 27.55777836419 ], [ -80.41456550083, 27.55776136417 ], [ -80.41332450152, 27.55774636644 ], [ -80.41072250297, 27.55772937123 ], [ -80.40787450457, 27.55771337648 ], [ -80.4064185054, 27.55771337917 ], [ -80.40626650548, 27.55771037945 ], [ -80.40312950724, 27.55769138522 ], [ -80.40220350775, 27.55768038692 ], [ -80.4001705089, 27.55767739067 ], [ -80.39830350996, 27.55767739412 ], [ -80.39801551012, 27.55767439465 ], [ -80.39794051016, 27.55767339479 ], [ -80.39634151108, 27.55768039775 ], [ -80.39376751255, 27.55769140253 ], [ -80.39145151384, 27.55766640677 ], [ -80.39011051456, 27.55763040921 ], [ -80.38982751472, 27.55762440972 ], [ -80.37435952332, 27.55743243806 ], [ -80.37364052372, 27.55742143938 ], [ -80.37356152374, 27.5574024395 ], [ -80.36974752589, 27.55738144652 ], [ -80.36900852631, 27.55737344787 ], [ -80.36891252636, 27.55737244805 ], [ -80.36886152639, 27.55737244814 ], [ -80.36838052667, 27.55737444903 ], [ -80.36830652671, 27.55737444917 ], [ -80.36808752683, 27.55737444958 ], [ -80.36801452687, 27.55737444971 ], [ -80.36788352695, 27.55737544995 ], [ -80.36771452704, 27.55737345026 ], [ -80.36661152766, 27.55736345229 ], [ -80.36655852769, 27.55736345239 ], [ -80.36240153002, 27.55732446002 ], [ -80.36196053027, 27.55732046083 ], [ -80.36099953083, 27.55733046261 ], [ -80.36049253111, 27.55732846355 ], [ -80.36006653136, 27.55732646433 ], [ -80.35988553146, 27.55732746467 ], [ -80.35970153156, 27.55732546501 ], [ -80.35938653174, 27.55732446559 ], [ -80.35897753197, 27.55732246634 ], [ -80.35847153226, 27.55732146727 ], [ -80.35810953246, 27.55731846794 ], [ -80.35702653308, 27.55731446993 ], [ -80.35666553328, 27.5573124706 ], [ -80.35657653333, 27.55731047076 ], [ -80.35630853348, 27.55730847125 ], [ -80.35621953353, 27.55730847142 ], [ -80.35606753362, 27.5573064717 ], [ -80.35465953441, 27.55729547428 ], [ -80.35044753678, 27.55726248202 ], [ -80.35036553683, 27.55726148217 ], [ -80.35028253687, 27.55726048232 ], [ -80.34997753704, 27.55725748288 ], [ -80.3493505374, 27.55725348403 ], [ -80.34841753792, 27.55724648575 ], [ -80.34836553795, 27.55724648585 ], [ -80.34821353804, 27.55724648613 ], [ -80.34816253807, 27.55724748622 ], [ -80.3489235402, 27.56035948901 ], [ -80.35120754673, 27.56969749733 ], [ -80.35179854846, 27.57211149946 ], [ -80.35196554896, 27.57281150009 ], [ -80.352631551, 27.57560850259 ], [ -80.35463255722, 27.58399951005 ], [ -80.35529955934, 27.58679651252 ], [ -80.35556356018, 27.5879075135 ], [ -80.35558456025, 27.58799351358 ], [ -80.35632856276, 27.5912475165 ], [ -80.35658356362, 27.5923615175 ], [ -80.3566055637, 27.59245751759 ], [ -80.35662756377, 27.59255351767 ], [ -80.35665356386, 27.59266951778 ], [ -80.35687856463, 27.59365351866 ], [ -80.35735756627, 27.59574652053 ], [ -80.35776556768, 27.59753052212 ], [ -80.3580625687, 27.59882352327 ], [ -80.35849557021, 27.60071752496 ], [ -80.35938157333, 27.6045875284 ], [ -80.36015157458, 27.60628052915 ], [ -80.36095657591, 27.60805052994 ], [ -80.36099757598, 27.60814052998 ], [ -80.36112157619, 27.6084135301 ], [ -80.36116357626, 27.60850453014 ], [ -80.36161257701, 27.60949153058 ], [ -80.36295957929, 27.61245253187 ], [ -80.36340958006, 27.6134405323 ], [ -80.3646425822, 27.61615253347 ], [ -80.36657658564, 27.62040353528 ], [ -80.36744258687, 27.6219435356 ], [ -80.36866858863, 27.62412653606 ], [ -80.3693335896, 27.6253085363 ], [ -80.36965859084, 27.62669953748 ], [ -80.36968459094, 27.62681153757 ], [ -80.37468059008, 27.62689352781 ], [ -80.37474158912, 27.62590952641 ], [ -80.37493158619, 27.62290952213 ], [ -80.37499458521, 27.62190952071 ], [ -80.37497858518, 27.62186952069 ], [ -80.37474958469, 27.62131652042 ], [ -80.37452358422, 27.62077252016 ], [ -80.37435058381, 27.62030451989 ], [ -80.37422058347, 27.61991951964 ], [ -80.37412758326, 27.61968851952 ], [ -80.37408458322, 27.61962751953 ], [ -80.37397958315, 27.61953451961 ], [ -80.3739365831, 27.61946851961 ], [ -80.373886583, 27.61935251956 ], [ -80.37380558271, 27.61903951931 ], [ -80.3736875823, 27.61858151894 ], [ -80.38084858088, 27.61882550522 ], [ -80.38085558036, 27.61830850454 ], [ -80.38085557983, 27.61777850386 ], [ -80.38088557934, 27.61728850317 ], [ -80.38093557896, 27.6169285026 ], [ -80.38101557851, 27.61648850188 ], [ -80.38109557802, 27.61601850112 ], [ -80.38124557798, 27.61601850083 ], [ -80.38138157795, 27.61601850056 ], [ -80.38144557793, 27.61601850043 ], [ -80.38229557772, 27.61601849877 ], [ -80.38249557767, 27.61602149838 ], [ -80.38284557759, 27.61602849771 ], [ -80.38290557758, 27.61602849759 ], [ -80.38295557756, 27.61601849748 ], [ -80.38332857747, 27.61602649676 ], [ -80.38379557737, 27.61603849586 ], [ -80.38478057713, 27.61603849394 ], [ -80.38526557701, 27.61603849299 ], [ -80.3852655772, 27.61622449323 ], [ -80.38526557757, 27.61658849369 ], [ -80.38525957777, 27.61678249395 ], [ -80.38525557796, 27.6169684942 ], [ -80.38565657786, 27.61696849341 ], [ -80.3859255778, 27.61696849289 ], [ -80.38654557766, 27.61697849169 ], [ -80.38686057758, 27.61697849107 ], [ -80.38698557755, 27.61697849083 ], [ -80.38717557753, 27.61699849048 ], [ -80.38722557759, 27.61706849047 ], [ -80.38731557754, 27.61704849027 ], [ -80.3874755775, 27.61704848996 ], [ -80.38769557747, 27.61706848955 ], [ -80.38783557749, 27.61711848934 ], [ -80.38813557745, 27.61714848879 ], [ -80.38829557739, 27.61712848845 ], [ -80.38847557729, 27.61707848804 ], [ -80.38835557703, 27.61679848791 ], [ -80.38801557636, 27.61606848765 ], [ -80.38837557627, 27.61606848694 ], [ -80.38887057615, 27.61607548599 ], [ -80.38951657755, 27.61756148661 ], [ -80.39110257718, 27.61756648351 ], [ -80.39199757696, 27.61756948177 ], [ -80.39214557699, 27.61762848155 ], [ -80.39212757695, 27.61758148153 ], [ -80.39200557663, 27.61725848136 ], [ -80.39192557645, 27.61706848127 ], [ -80.39174557592, 27.61652848094 ], [ -80.39172657587, 27.61647648091 ], [ -80.39159557552, 27.6161084807 ], [ -80.39186057546, 27.61611248018 ], [ -80.39220557538, 27.61611847952 ], [ -80.39265857527, 27.61611847863 ], [ -80.3929255752, 27.61611847811 ], [ -80.39339557508, 27.61611847719 ], [ -80.39364557503, 27.61612847671 ], [ -80.39383557499, 27.61612847634 ], [ -80.39396557496, 27.6161384761 ], [ -80.39440457486, 27.61614447525 ], [ -80.3946655748, 27.61614847474 ], [ -80.39560557457, 27.61614847291 ], [ -80.39709557421, 27.61615847 ], [ -80.39789257403, 27.61617246846 ], [ -80.39821557396, 27.61617846784 ], [ -80.39862557386, 27.61617846704 ], [ -80.39866557385, 27.61617846696 ], [ -80.39870557384, 27.61617846688 ], [ -80.39885157381, 27.6161794666 ], [ -80.39940957367, 27.61618546551 ], [ -80.39959557363, 27.61618846515 ], [ -80.39979557358, 27.61618946476 ], [ -80.40039557344, 27.6161954636 ], [ -80.4005955734, 27.61619846321 ], [ -80.40159557316, 27.61620846126 ], [ -80.40169357314, 27.61621146108 ], [ -80.40231557301, 27.61622845988 ], [ -80.40234557295, 27.61618745977 ], [ -80.40243557297, 27.61621845963 ], [ -80.40311557282, 27.61623845833 ], [ -80.40326557277, 27.61622845802 ], [ -80.40332557277, 27.61623845792 ], [ -80.40417557257, 27.61624845627 ], [ -80.40482557242, 27.61625845501 ], [ -80.40514557234, 27.61625845438 ], [ -80.40580557222, 27.61628845313 ], [ -80.40608757214, 27.61628345257 ], [ -80.40644557205, 27.61627845186 ], [ -80.40682557197, 27.61628845113 ], [ -80.40693357194, 27.61628845092 ], [ -80.40712557189, 27.61628845055 ], [ -80.40721557186, 27.61627845036 ], [ -80.40738557184, 27.61629845005 ], [ -80.40742657183, 27.61629644997 ], [ -80.40760557177, 27.61628844961 ], [ -80.40797557168, 27.61628844888 ], [ -80.40806357167, 27.61629144872 ], [ -80.40822557163, 27.61629844841 ], [ -80.40827557163, 27.61630844832 ], [ -80.40832557161, 27.61629844821 ], [ -80.40847657158, 27.61630144792 ], [ -80.40908357144, 27.61631644675 ], [ -80.40912557144, 27.61631844667 ], [ -80.40929457138, 27.61630844633 ], [ -80.41029557117, 27.61633844441 ], [ -80.41055557111, 27.6163384439 ], [ -80.41132557092, 27.61633844239 ], [ -80.41188557079, 27.61634844131 ], [ -80.41232557069, 27.61634844045 ], [ -80.41246557065, 27.61634844017 ], [ -80.41345557043, 27.61636843826 ], [ -80.41388557035, 27.61638843745 ], [ -80.41388957018, 27.61624543726 ], [ -80.41389556988, 27.61598843693 ], [ -80.41389256967, 27.61581143672 ], [ -80.41388556923, 27.61543843628 ], [ -80.41389456896, 27.61521543599 ], [ -80.41390556866, 27.61495843565 ], [ -80.41390956838, 27.61472443535 ], [ -80.41391556805, 27.614448435 ], [ -80.4139155678, 27.61422843473 ], [ -80.41391556755, 27.61401843448 ], [ -80.41391556728, 27.6137914342 ], [ -80.41391556713, 27.61366843405 ], [ -80.41392556653, 27.6131584334 ], [ -80.41393556588, 27.6126084327 ], [ -80.41392756566, 27.61241843249 ], [ -80.41392056548, 27.61226743232 ], [ -80.41391656536, 27.6121634322 ], [ -80.4139355652, 27.61202843199 ], [ -80.41394556426, 27.611238431 ], [ -80.41394556353, 27.61061843024 ], [ -80.41395256316, 27.61030742985 ], [ -80.41395556307, 27.61022842974 ], [ -80.41394556255, 27.60978842922 ], [ -80.41395656206, 27.6093774287 ], [ -80.4139655617, 27.6090684283 ], [ -80.41396556161, 27.60899442821 ], [ -80.41396956135, 27.60877542793 ], [ -80.41397156126, 27.60870242784 ], [ -80.41397156121, 27.60865942778 ], [ -80.41397456106, 27.60853042762 ], [ -80.41397556101, 27.60848842757 ], [ -80.41398456027, 27.60786642678 ], [ -80.41398556022, 27.60781842672 ], [ -80.41399555873, 27.60655842516 ], [ -80.41400455806, 27.60599942445 ], [ -80.41401555733, 27.60537842367 ], [ -80.41401555722, 27.60528842356 ], [ -80.4140155569, 27.60501842323 ], [ -80.4140155568, 27.60492842312 ], [ -80.41401555667, 27.60481842298 ], [ -80.41401555628, 27.60448842258 ], [ -80.41401555615, 27.60437842244 ], [ -80.41401755609, 27.60432742237 ], [ -80.41402355591, 27.60417842218 ], [ -80.41402555585, 27.60412842211 ], [ -80.41402655571, 27.60401142197 ], [ -80.4140335553, 27.60366342153 ], [ -80.41403555516, 27.60354842138 ], [ -80.41403555511, 27.60350542133 ], [ -80.41403555496, 27.60338042118 ], [ -80.41403555491, 27.60333842112 ], [ -80.41403555457, 27.60304842077 ], [ -80.41403555453, 27.60301342073 ], [ -80.41403555443, 27.60293142062 ], [ -80.41403555411, 27.60265842029 ], [ -80.41403555399, 27.60255842017 ], [ -80.4140355539, 27.60247842007 ], [ -80.41404055338, 27.60204141952 ], [ -80.414045553, 27.60171841912 ], [ -80.41404555297, 27.60169641909 ], [ -80.4140485529, 27.601632419 ], [ -80.41404955287, 27.60161141898 ], [ -80.41405555267, 27.60143841875 ], [ -80.4140555526, 27.60138041868 ], [ -80.41405555248, 27.60127841856 ], [ -80.41405555235, 27.60116841842 ], [ -80.41405555204, 27.6009084181 ], [ -80.41405555178, 27.60068841783 ], [ -80.41405555151, 27.60045841755 ], [ -80.41405555139, 27.60035841743 ], [ -80.41406555096, 27.59999941697 ], [ -80.41406555064, 27.59972841663 ], [ -80.41406555028, 27.59941841625 ], [ -80.41407554985, 27.59905841579 ], [ -80.41407554958, 27.59882841551 ], [ -80.41407554934, 27.59862341526 ], [ -80.41407554931, 27.59859841523 ], [ -80.41408254879, 27.59816541468 ], [ -80.4140855486, 27.59799841447 ], [ -80.4140855485, 27.59792141438 ], [ -80.41408554828, 27.59772841414 ], [ -80.41408554818, 27.59764841404 ], [ -80.41408554779, 27.59731841363 ], [ -80.41408854764, 27.59719141347 ], [ -80.41409554735, 27.59694841316 ], [ -80.41409754723, 27.59684441303 ], [ -80.41410354686, 27.59653241264 ], [ -80.41410554674, 27.5964284125 ], [ -80.41410554626, 27.59602541201 ], [ -80.41410554592, 27.59573841166 ], [ -80.41410554545, 27.59533841117 ], [ -80.41410554513, 27.59506841083 ], [ -80.41410854483, 27.59481941052 ], [ -80.41411554436, 27.59441841002 ], [ -80.41412054429, 27.59436240994 ], [ -80.41412554425, 27.59432840989 ], [ -80.41412554409, 27.59419640972 ], [ -80.41412554403, 27.59414140966 ], [ -80.41412554388, 27.59401840951 ], [ -80.41413554363, 27.59380840923 ], [ -80.4141355429, 27.59318840847 ], [ -80.41414054248, 27.59283440802 ], [ -80.41414554209, 27.59250840761 ], [ -80.41415354167, 27.59215540716 ], [ -80.41415554159, 27.59208840708 ], [ -80.41414554134, 27.59186840683 ], [ -80.41416554103, 27.59161840648 ], [ -80.41416554072, 27.59134840615 ], [ -80.41416554042, 27.59110040585 ], [ -80.41416554001, 27.59074840541 ], [ -80.41416553962, 27.59041840501 ], [ -80.41418153914, 27.59002040449 ], [ -80.41418553903, 27.58992840437 ], [ -80.41420553748, 27.58861840272 ], [ -80.4142155367, 27.5879684019 ], [ -80.41421453662, 27.58789940182 ], [ -80.41421353655, 27.58783640175 ], [ -80.41420553569, 27.58710840087 ], [ -80.41373553587, 27.58709840175 ], [ -80.41318953609, 27.58709840279 ], [ -80.41285553623, 27.58709840342 ], [ -80.4121405365, 27.58707940476 ], [ -80.41214153637, 27.58696640462 ], [ -80.41218553217, 27.58339940014 ], [ -80.41218653205, 27.58329440001 ], [ -80.41014953305, 27.58340340401 ], [ -80.41016852877, 27.57972139942 ], [ -80.41041552866, 27.57971839895 ], [ -80.41115552834, 27.57972839757 ], [ -80.41160552814, 27.57972839672 ], [ -80.41177552809, 27.57974839642 ], [ -80.4124955278, 27.5797783951 ], [ -80.41264552773, 27.57977839481 ], [ -80.4127255277, 27.57977839466 ], [ -80.41389552719, 27.57978839247 ], [ -80.41427552702, 27.57978839175 ], [ -80.41427552699, 27.57976339172 ], [ -80.4142795269, 27.57968839162 ], [ -80.41428152687, 27.57966439158 ], [ -80.41428152685, 27.57964839156 ], [ -80.41428452679, 27.5796033915 ], [ -80.41428552678, 27.57958839148 ], [ -80.41428952638, 27.57925439107 ], [ -80.41429552595, 27.57888839061 ], [ -80.4142885252, 27.57825238984 ], [ -80.4142855248, 27.57791838943 ], [ -80.41428952437, 27.57755338898 ], [ -80.41430152308, 27.57646238762 ], [ -80.41430552264, 27.57609838716 ], [ -80.41431552237, 27.57586838686 ], [ -80.41431552175, 27.57534438622 ], [ -80.41431552159, 27.57520838605 ], [ -80.41434551906, 27.57308238338 ], [ -80.41434551817, 27.57232838246 ], [ -80.41434951813, 27.57229838241 ], [ -80.41435551807, 27.57224838234 ], [ -80.4143655168, 27.57117838101 ], [ -80.41437151638, 27.57082038056 ], [ -80.41439551486, 27.56954837895 ], [ -80.41441551282, 27.5678283768 ], [ -80.41444351128, 27.56653837517 ], [ -80.41444551121, 27.56647837509 ], [ -80.41445551015, 27.56558837398 ], [ -80.41446150978, 27.56528237359 ], [ -80.41446150976, 27.56526037357 ], [ -80.4144625097, 27.56521537351 ], [ -80.41446250969, 27.56520337349 ], [ -80.41446350949, 27.56503437328 ], [ -80.41446450942, 27.56497837321 ], [ -80.41447150857, 27.56426337232 ], [ -80.41448350722, 27.5631243709 ], [ -80.41451050602, 27.56212236962 ], [ -80.41451550581, 27.5619493694 ], [ -80.41451550517, 27.56140836874 ], [ -80.41452350483, 27.56112436837 ], [ -80.41452550477, 27.5610683683 ], [ -80.41453750382, 27.5602733673 ], [ -80.41454250348, 27.55999036695 ], [ -80.41454350323, 27.55978136669 ], [ -80.41454050243, 27.55909836586 ], [ -80.41454850198, 27.55872536538 ], [ -80.41454750175, 27.55852936514 ], [ -80.4145555013, 27.55815636467 ], [ -80.41457250104, 27.55794136438 ]
  ];

  const squareGeoJSON = {
    type: 'Feature',
    geometry: {
      type: 'Polygon',
      coordinates: [squareCoordinates],
    },
  };

  // Function to handle zoom in
  const handleZoomIn = () => {
    mapRef.current.zoomIn();
  };

  // Function to handle zoom out
  const handleZoomOut = () => {
    mapRef.current.zoomOut();
  };

  // Function to handle zip code submission
  const handleSubmit = async (e) => {
    e.preventDefault();

    // Fetch the coordinates using the Mapbox Geocoding API
    const response = await fetch(
      `https://api.mapbox.com/geocoding/v5/mapbox.places/${zipCode}.json?access_token=${MAPBOX_TOKEN}`
    );
    const data = await response.json();

    if (data.features && data.features.length > 0) {
      const [longitude, latitude] = data.features[0].center;

      // Fly the map to the new location based on the zip code
      mapRef.current.flyTo({
        center: [longitude, latitude],
        zoom: 12,
        essential: true, // This ensures the map animation is smooth
      });
    } else {
      alert('Zip code not found. Please try again.');
    }
  };

  return (
    <div className="relative w-full h-screen">
      {/* The Map */}
      <Map
        ref={mapRef}
        initialViewState={{
          latitude: 38.9072, // Washington, DC
          longitude: -77.0369, 
          zoom: 13,  // Zoom level set for better visibility
        }}
        className="absolute inset-0 w-full h-full"
        mapStyle="mapbox://styles/mapbox/streets-v11"
        mapboxAccessToken={MAPBOX_TOKEN}
      >
        {/* Add the polygon for the square */}
        <Source id="square" type="geojson" data={squareGeoJSON}>
          <Layer
            id="square-layer"
            type="fill"
            paint={{
              'fill-color': 'red',  // Fill the square with red color
              'fill-opacity': 0.5,  // Set opacity
            }}
          />
        </Source>
      </Map>
      
      {/* Zoom Controls */}
      <div className="absolute w-10 top-6 left-4 flex flex-col space-y-2">
        <button 
          onClick={handleZoomIn} 
          className="bg-white p-2 rounded shadow hover:bg-gray-200"
        >
          <div className="font-extrabold text-gray-300">+</div>
        </button>
        <button 
          onClick={handleZoomOut} 
          className="bg-white p-2 rounded shadow hover:bg-gray-200"
        >
          <div className="font-black text-gray-300">-</div>
        </button>
      </div>

      {/* Zip Code Input Popup */}
      <div className="absolute bottom-4 right-4 p-4 bg-white rounded shadow-md z-10">
        <form onSubmit={handleSubmit} className="flex items-center space-x-2">
          <input
            type="text"
            placeholder="Enter Zip Code"
            value={zipCode}
            onChange={(e) => setZipCode(e.target.value)}
            className="border border-gray-300 p-2 rounded w-40"
          />
          <button type="submit" className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            Enter
          </button>
        </form>
      </div>
    </div>
  );
};

export default MapComponent;

